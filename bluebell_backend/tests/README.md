# 🚀 创建帖子压测工具使用指南

## 📋 快速开始

### 1. 基础压测（推荐新手）
```bash
cd tests
# 50并发，30秒压测
create_post_load_test.bat
```

### 2. 高级压测（专业版）
```bash
cd tests
# 自定义参数：100并发，60秒
create_post_advanced.bat -c 100 -d 60 -m manual
```

## 🎯 三种测试模式

### 模式1: Manual（推荐）
- 使用Go程序压测
- 支持动态数据生成
- 实时统计和错误处理
- 适合性能调优

```bash
create_post_advanced.bat -m manual -c 50 -d 30
```

### 模式2: go-wrk
- 使用go-wrk工具
- 固定请求数据
- 标准压测格式
- 适合对比测试

```bash
create_post_advanced.bat -m go-wrk -c 100 -d 60
```

### 模式3: Compare
- 两种模式对比
- 相同参数测试
- 结果对比分析

```bash
create_post_advanced.bat -m compare -c 50 -d 10
```

## 📊 参数说明

| 参数 | 默认值 | 说明 | 示例 |
|------|--------|------|------|
| -c | 50 | 并发数 | -c 100 |
| -d | 30 | 持续时间(秒) | -d 60 |
| -u | localhost:8081 | 服务地址 | -u http://192.168.1.100:8081 |
| -m | manual | 测试模式 | -m go-wrk |

## 🔧 使用步骤

### 步骤1: 启动服务
```bash
cd bluebell_backend
go run main.go
```

### 步骤2: 准备测试数据
```bash
cd scripts
quick_data_generator.bat medium
```

### 步骤3: 执行压测
```bash
cd ../tests
# 基础测试
create_post_load_test.bat

# 或者高级测试
create_post_advanced.bat -c 100 -d 60 -m manual
```

## 📈 性能基准

### 中等规模数据预期
- **QPS**: 800-1500
- **平均响应时间**: <100ms
- **错误率**: <1%
- **并发支持**: 50-100

### 性能调优建议
1. **数据库优化**
   - 检查posts表索引
   - 优化社区外键查询
   - 调整连接池配置

2. **缓存策略**
   - 启用Redis缓存
   - 预热热点数据
   - 设置合理TTL

3. **系统调优**
   - 增加Gin工作线程
   - 调整MySQL配置
   - 监控资源使用

## 🐛 常见问题

### 问题1: 连接被拒绝
```
解决方案:
1. 检查服务是否启动
2. 确认端口号正确
3. 检查防火墙设置
```

### 问题2: 错误率过高
```
解决方案:
1. 检查数据库连接数
2. 查看慢查询日志
3. 增加连接池大小
```

### 问题3: 响应时间过长
```
解决方案:
1. 检查数据库索引
2. 启用Redis缓存
3. 优化SQL查询
```

## 📊 结果解读

### 关键指标
- **QPS**: 每秒查询数，越高越好
- **响应时间**: 平均响应时间，越低越好
- **错误率**: 失败请求比例，越低越好
- **95/99分位**: 长尾延迟指标

### 性能等级
- **优秀**: QPS > 1000, 响应时间 < 50ms
- **良好**: QPS 500-1000, 响应时间 50-100ms
- **一般**: QPS 100-500, 响应时间 100-200ms
- **需优化**: QPS < 100, 响应时间 > 200ms

## 🎯 实战案例

### 案例1: 100并发压测
```bash
create_post_advanced.bat -c 100 -d 30 -m manual
```
预期结果:
- 总请求: 15,000-30,000
- QPS: 500-1000
- 平均响应: 50-100ms

### 案例2: 极限压测
```bash
create_post_advanced.bat -c 200 -d 60 -m go-wrk
```
预期结果:
- 总请求: 30,000-60,000
- QPS: 500-1000
- 需要监控系统资源

## 🔍 监控建议

### 监控指标
1. **系统层面**
   - CPU使用率
   - 内存使用量
   - 磁盘I/O
   - 网络带宽

2. **数据库层面**
   - 连接数
   - 慢查询数量
   - 锁等待时间
   - 缓存命中率

3. **应用层面**
   - 请求数
   - 错误数
   - 响应时间分布
   - Goroutine数量

## 🚀 一键测试

### 完整测试流程
```bash
# 一键执行所有测试
run_all_tests.bat
```

### 测试报告
测试完成后会生成:
- 性能统计报告
- 错误日志分析
- 优化建议清单